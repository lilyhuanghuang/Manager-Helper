"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.searchModuleImport=searchModuleImport,exports.updateManifest=updateManifest;var _utils=require("./utils");function frameworkInit(){global.framework={module:{base:"system",ext:"service"},reservedFeatures:[],reservedFeatureExclude:[],supportInCard:[],project:{manifestFilePath:null,featureList:[],module:{usedBaseAll:!1,usedExtAll:!1}}},global.framework.reservedFeatures=global.framework.reservedFeatures.concat([`${global.framework.module.base}.contact`,`${global.framework.module.base}.webview`,`${global.framework.module.base}.notification`,`${global.framework.module.base}.media`,`${global.framework.module.base}.file`,`${global.framework.module.base}.storage`,`${global.framework.module.base}.vibrator`,`${global.framework.module.base}.calendar`,`${global.framework.module.base}.shortcut`,`${global.framework.module.base}.network`,`${global.framework.module.base}.fetch`,`${global.framework.module.base}.geolocation`,`${global.framework.module.base}.request`,`${global.framework.module.base}.share`,`${global.framework.module.base}.clipboard`,`${global.framework.module.base}.prompt`,`${global.framework.module.base}.device`,`${global.framework.module.base}.barcode`,`${global.framework.module.base}.bluetooth`,`${global.framework.module.base}.sensor`,`${global.framework.module.base}.audio`,`${global.framework.module.base}.package`,`${global.framework.module.base}.volume`,`${global.framework.module.base}.record`,`${global.framework.module.base}.brightness`,`${global.framework.module.base}.battery`,`${global.framework.module.base}.image`,`${global.framework.module.base}.cipher`,`${global.framework.module.base}.sms`,`${global.framework.module.base}.wifi`,`${global.framework.module.base}.websocketfactory`,`${global.framework.module.base}.alarm`,`${global.framework.module.ext}.alipay`,`${global.framework.module.ext}.push`,`${global.framework.module.ext}.pay`,`${global.framework.module.ext}.share`,`${global.framework.module.ext}.wxpay`,`${global.framework.module.ext}.stats`,`${global.framework.module.ext}.account`,`${global.framework.module.ext}.wxaccount`,`${global.framework.module.ext}.qqaccount`,`${global.framework.module.ext}.wbaccount`]),global.framework.reservedFeatureExclude.push(`${global.framework.module.base}.app`),global.framework.reservedFeatureExclude.push(`${global.framework.module.base}.model`),global.framework.reservedFeatureExclude.push(`${global.framework.module.base}.router`),global.framework.supportInCard=global.framework.supportInCard.concat([`${global.framework.module.base}.share`,`${global.framework.module.base}.prompt`,`${global.framework.module.base}.vibrator`,`${global.framework.module.base}.fetch`,`${global.framework.module.base}.storage`,`${global.framework.module.base}.clipboard`,`${global.framework.module.base}.geolocation`,`${global.framework.module.base}.network`,`${global.framework.module.base}.device`,`${global.framework.module.base}.battery`,`${global.framework.module.base}.calendar`,`${global.framework.module.base}.package`,`${global.framework.module.base}.app`,`${global.framework.module.base}.router`])}function searchModuleImport(e,o={}){const a=[],r=new RegExp(`['"]@(${global.framework.module.base}|${global.framework.module.ext}).*?['"]`,"g"),l=new RegExp(`['"]@((${global.framework.module.base}|${global.framework.module.ext}).*?)['"]`);return(e.match(r)||[]).forEach(e=>{const r=(e.match(l)||[])[1];r===`@${global.framework.module.base}`?global.framework.project.module.usedBaseAll=!0:r===`@${global.framework.module.ext}`?global.framework.project.module.usedExtAll=!0:-1!==global.framework.reservedFeatures.indexOf(r)?-1===global.framework.project.featureList.indexOf(r)&&global.framework.project.featureList.push(r):o.uxType===_utils.ENTRY_TYPE.CARD&&-1===global.framework.supportInCard.indexOf(r)?a.push({reason:`WARN: 您引入了卡片中未识别的native模块：${r}`}):-1!==global.framework.reservedFeatureExclude.indexOf(r)||a.push({reason:`WARN: 您引入了未识别的native模块：${r}`})}),{fileCont:e,logFeatureList:a}}function checkFeatureInCard(e={}){Object.keys(e).forEach(o=>{e[o].features.every(e=>{-1===global.framework.supportInCard.indexOf(e.name)&&_utils.colorconsole.error(`WARN: manifest.json文件中引入了卡片${o}未识别的features：${e.name}`)})})}function updateManifest(e,o){e.config=e.config||{},e.config.debug=o,e.minPlatformVersion||(e.minPlatformVersion=1020),e.features=e.features||[],checkFeatureInCard(e.router.widgets||{});const a=[].concat(global.framework.project.featureList);e.features.forEach(e=>{const o=a.indexOf(e.name);-1!==o&&a.splice(o,1)});const r=[];if(a.forEach(e=>{-1!==global.framework.reservedFeatures.indexOf(e)&&r.push(e)}),r.length>0){const o=r.map(function(e){return{name:e}});e.features=e.features.concat(o);const a=r.join(", ");_utils.colorconsole.warn(`manifest.json 中包含了未声明的 features: ${a}\n`)}return e}frameworkInit();
//# sourceMappingURL=shared.js.map
